---
icon: shuffle
---

# 4. Server Side Request Forgery

<div align="center">

<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSwrYxJeahR9_oCFquK0xWL2NrSjo-JsQmflg&#x26;s" alt="" height="200" width="200">

</div>

## Server Side Request Forgery (SSRF)

_Server Side Request Forgery (SSRF)_. Es un tipo de vulnerabilidad que permite a un atacante realizar peticiones desde la aplicación hacia una localización involuntaria. En un ataque típico de _SSRF_, el atacante ocasiona que el servidor realice peticiones a sí mismo, logrando de esa forma realizar peticiones que en un principio están limitadas a ser creadas de forma interna por los mismos servicios de la infraestructura de la organización. En otros casos, son capaces de forzar al servidor a conectarse de forma arbitraria a sistemas externos, lo que potencialmente termine en filtración de información sensible como credenciales de autorización o revelar el comportamiento privado del sitio para su corrupción.

## Como funciona un _SSRF_

En el momento que el servidor realiza un llamada a una URL, como podría ser una API, un atacante pude editar la petición para cambiar la dirección de destino.

* **Ataque SSRF contra el mismo servidor**
  * En un ataque _SSRF_ contra el servidor, el atacante modifica el comportamiento del servidor al momento de realizar una petición o llamada a una URL, sustituyendo el URL con su interfaz de red _loopback_. Lo que regularmente involucra al _hostname_ `127.0.0.1`, una dirección _IP_ reservada para el adaptador _loopback_ o el _localhost_ un nombre común para el adaptador.
  * Por ejemplo, imagina una tienda en linea que permite al usuario ver cuantos productos quedan en el inventario de una tienda particular. Para proporcionar la información. la aplicación debe de realizar multiples peticiones a las _back-end REST APIs_. Lo realiza pasando el URL a una relevante _back-end API endpoint_ por medio de la petición HTTP _front-end_. Cuando un usuario ve el inventario de un producto, el buscador realiza la siguiente petición: `POST /product/stock HTTP/1.0 Content-Type: application/x-www-form-urlencoded Content-Length: 118 stockApi=http://stock.weliketoshop.net:8080/product/stock/check%3FproductId%3D6%26storeId%3D1` La petición hace que el servidor cree una nueva consulta al URL especificado, retornando el estado del inventario y finalmente redirigiendo el resultado al usuario. En este escenario, un atacante puede modificar la petición para especificar un URL local a el servidor: `POST /product/stock HTTP/1.0 Content-Type: application/x-www-form-urlencoded Content-Length: 118 stockApi=http://localhost/admin` El servidor retorna el contenido del directorio `/admin` al usuario. Dicho directorio podría ser visible para cualquier usuario, sin garantizar autorización o simplemente estar restringido a servicios locales y al hacer la petición desde el mismo servidor y ya no desde nuestro buscador como usuario, podemos evadir dichas restricciones.
* **Ataque SSRF contra otro sistema back-end**
  * En algunos casos, el servidor tiene la habilidad de interactuar con otros sistemas _back-end_ que en un inicio el usuario no es capaz de interactuar directamente. Estos sistemas pueden ofrecen un acceso a direcciones IP no accesibles desde fuera del sistema local.
  * En ocasiones los servidores _back-end_ son protegidos por la misma topología de red al no estar dirigidos a una salida directa a internet, así que ofrecen una postura de seguridad más débil. En varios casos, los sistemas _back-end_ contienen información sensible y funcionalidades sensibles que pueden ser accedidas sin autenticación por cualquiera que pueda interactuar con el sistema.
  * En el ejemplo anterior, suponiendo que exista un panel administrativo en la dirección `https://192.168.0.68/admin`. Un atacante puede mandar la siguiente petición para explotar la vulnerabilidad _SSRF_ y acceder al panel de administración `POST /product/stock HTTP/1.0 Content-Type: application/x-www-form-urlencoded Content-Length: 118 stockApi=http://192.168.0.68/admin`

## References

[https://portswigger.net/web-security/learning-paths/server-side-vulnerabilities-apprentice/ssrf-apprentice/ssrf/what-is-ssrf](https://portswigger.net/web-security/learning-paths/server-side-vulnerabilities-apprentice/ssrf-apprentice/ssrf/what-is-ssrf)
