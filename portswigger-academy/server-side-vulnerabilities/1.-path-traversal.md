---
icon: list-tree
---

# 1. Path traversal

<div align="center">

<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSwrYxJeahR9_oCFquK0xWL2NrSjo-JsQmflg&#x26;s" alt="" height="200" width="200">

</div>

## Path Traversal

_Path traversal_, también conocido como _directory traversal_. Es un conjunto de vulnerabilidades que permiten a un atacante leer de forma arbitraria archivos en el servidor. Dentro de los archivos sensibles que pueden ser objetivo son:

* Código fuente de la aplicación y datos sensibles
* Credenciales de los sistemas _back-end_
* Archivos sensibles sobre el sistema operativo En algunos casos, el atacante tiene la capacidad de escribir archivos de forma arbitraria, permitiendo al atacante modificar el comportamiento habitual de la aplicación y la capacidad de ganar control total del servidor.

## Causas

La principal causa es el débil filtrado en entradas y salidas, puntualmente, escaso o nulo filtro de los caracteres _"."_, _"/"_ y/o _"\\"_ y sus variaciones, pues dichos caracteres son los responsables de permitir el apuntado a una ruta diferente de la esperada&#x20;

## Ejemplo&#x20;

El árbol de archivos de este ejemplo se vería de la siguiente forma:

```Txt
/-
  | - Files-
  |         | - imagen.png
  |
  | - Secrets-
              | - secret.txt
```

En este ejemplo, el sitio espera recibir el nombre de un archivo ubicado dentro de la carpeta _Files_, en este caso, el nombre del archivo _imagen.png_, si se trata de acceder a cualquier otro archivo de forma convencional, se entregará un error _404 Not found_, pues cualquier otro nombre de archivo diferente de _imagen.png_, no existe dentro de la carpeta _Files_, en cambio, si la entrada que recibe el nombre de archivo no se encuentra _sanitizada_, con filtros que eviten los caracteres mencionados con anterioridad además de sus múltiples variaciones sobre las que se aborda más adelante, puede ser especificada una ruta que apunte a un directorio diferente a _Files_.&#x20;

En este escenario, el sitio agrega el sufijo de la ruta absoluta que apunta al directorio _Files_, se vería de la siguiente forma el sufijo _/Files/_ en adición al nombre terminaría por señalar la ruta absoluta al archivo, en un comportamiento esperado la combinación del sufijo y nombre de archivo existente terminaría siendo&#x20;

```
/Files/imagen.png
```

de esta manera se realiza la consulta del archivo especificado en la ruta absoluta y entregado. Al agregar los agentes maliciosos _"../"_, podemos exigir la obtención de un archivo ubicado en una ruta diferente a la esperada, aplicada a en anterior caso donde se sigue pidiendo el archivo existente dentro de _Files_ y agregando el sufijo especificado la ruta absoluta sobre la que se realiza la consulta del archivo se vería así:

```
/Files/../imagen.png 
```

Lo que en un inicio parece un sin sentido, pero para entenderlo hay que entender como funcionan los directorios a nivel de sistema, pues el conjunto de caracteres _"../"_ para Linux y _"..\\"_ para Windows, indican que se quiere regresar al directorio que antecede al actual, lo que en este escenario implica que si el sujeto se encuentra ubicado dentro del directorio _Files_ o _Secrets_, lo redirigiría al directorio raíz _/_.&#x20;

Siguiendo el razonamiento previo podemos llegar a la conclusión de que la consulta a la ruta&#x20;

```
/Files/../imagen.png
```

&#x20;Es equivalente a una consulta a la ruta&#x20;

```
/imagen.png
```

&#x20;Entonces implica que esta consulta busca el archivo ya no dentro del directorio _Files_ si no más bien en el directorio raíz _/_ A pesar de ser una consulta válida, no implica que exista un archivo _imagen.png_ dentro del directorio raíz, por lo que nos retornará un error _404 Not found_.&#x20;

Para evadir la errónea idea de que la consulta deformada no es válida, se sugiere hacer una consulta a un archivo del cual se tenga certeza, en mayor medida, su existencia. Para este escenario el archivo del cual se tiene certeza su existencia, según el árbol ilustrativo, es el archivo _secret.txt_ ubicado dentro del directorio _Secrets_ que a su vez se encuentra dentro del directorio raíz _/_ teniendo una ruta absoluta resultante en _/Secrets/secret.txt_&#x20;

Para acceder a este archivo se sigue el uso de _"../"_ para deformar nuestra consulta que ahora apunta al directorio raíz, por lo que se sigue la naturaleza de una consulta simple, especificando el directorio y el nombre del archivo al que queremos acceder, en este caso sería una consulta final a la ruta:

```
../Secrets/secret.txt
```

&#x20;Que culminaría con el sufijo original agregado por el sitio quedando en:

```
/Files/../Secrets/secret.txt
```

Nuevamente nos encontramos con una forma rebuscada en un primer ojo, pero recordando las propiedades de "../" podemos llegar a la conclusión que es equivalente a la ruta:&#x20;

```
/Secrets/secret.txt 
```

Donde finalmente nos entregará una respuesta satisfactoria, pues, el sitio corrobora la existencia del archivo.&#x20;

El anterior ejemplo es solo ilustrativo y poco realista, en un escenario práctico, al no tener conciencia en un inicio de desde que ruta se realizan las consultas, se opta por agregar un gran número de _"../"_ anidados unos a otros para garantizar que las consultas se realizaran desde un directorio raíz, y así basarse en archivos inherentes al sistema operativo para corroborar la validez en su consulta. Estos archivos pueden ser archivos de configuración propia del sistema, archivos de configuración basados en las tecnologías usadas dentro de la aplicación ó rutas explicitas y concretas descubiertas con antelación.&#x20;

La consulta al archivo _/etc/passwd_ en sistemas Linux, es muy popular para la validación de consultas, por lo que en más de una ocasión podrá ser observado en colecciones de consultas pre-construidas por uno mismo o por segundas personas, además de una variedad de técnicas para evadir los filtros que se encargan de eliminar los caracteres _".", "/", "\\"_ y sus variaciones.&#x20;

El ahora denominado _payload_ que entra dentro del grupo de los más sencillos podría ser

```Bash
../../../../../../../../../../../../etc/passwd
```

## References

[https://portswigger.net/web-security/learning-paths/server-side-vulnerabilities-apprentice/path-traversal-apprentice/file-path-traversal/what-is-path-traversal](https://portswigger.net/web-security/learning-paths/server-side-vulnerabilities-apprentice/path-traversal-apprentice/file-path-traversal/what-is-path-traversal)
