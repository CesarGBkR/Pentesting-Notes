# Headless

# Description

<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/26e076db204a74b99390e586d7ebcf8c.png" width="200" height="200">
</p>

#  Headless
## Walk through
### Enumeration
#### Port Enumeration 
Basic PORT enumeration with NMAP
```Bash
nmap -Pn -n -p- --min-rate 5000 --open $TARGET
```
*Note: in my case $TARGET is 192.168.1.69*

The reported ports are
```Bash
PORT     STATE 
22/tcp   open
5000/tcp open
```

#### Service Enumeration 
Now lets enumerate the services running on each port with
```Bash
nmap -sCV -p $PORTS --min-rate 5000 $TARGET
```

Output
```
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)
| ssh-hostkey:
|   256 90:02:94:28:3d:ab:22:74:df:0e:a3:b2:0f:2b:c6:17 (ECDSA)
|_  256 2e:b9:08:24:02:1b:60:94:60:b3:84:a9:9e:1a:60:ca (ED25519)
5000/tcp open  upnp?
| fingerprint-strings:
...SNIP...
|     <p>Message: Bad request version ('RTSP/1.0').</p>
|     <p>Error code explanation: 400 - Bad request syntax or unsupported method.</p>
|     </body>
|_    </html>
...SNIP...
```

#### 5000
The port 5000 hosted a web page, here is the index displayed

<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/f6131141-1aef-43cf-a652-ff781539f1ab" >
</p>

#### FUZZING
After knowing that there is a web server lets try to FUZZ other directories
I use the *directory-list-lowercase-2.3-medium.txt* from SECLIST and WFUZZ

Last command:
``` Bash
wfuzz --hc 404 -w ~/Wordlists/directory-list-lowercase-2.3-medium.txt http://10.10.11.8:5000/FUZZ
```

The output give a *support* and *dashboard* path
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/33c470a0-5ddb-4cdf-80b3-4efb3758b952" >
</p>

#### support
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/dab5a760-6cbb-477d-8d48-d45bde5ff5f9" >
</p>

#### dashboard
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/2e7908fb-31dd-4ecf-a6c1-17436dc522c7" >
</p>
  
#### Cookie
Also we can see a cookie, by the name we can suppose this cookie manage the role of the client. After look the message of the */dashboard* lets try to manipulate this element
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/631afe1f-fb80-4197-a467-74598c1e059c" width="700">
</p>

### Exploitation

#### Cookie
After play a wile with the behavior of */support* the request loos interesting to do something

After try with the classic HTML Injection we can see a warning screen
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/f3b1aaf9-5daf-4542-ba6d-6c428f82891e" width="700">
</p>

I tried a lot of bypasses bunt nothing works
The warning screen reflect the headers of the client request, so lets try with that
First over message an error is caused
Then lets add a simple Script Injection to do a fetch to our simple server 
This request would have embedded the cookie of the client, in this case the client is the server, this theoretically should sen to us the admin cookie 
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/92a2bd7d-5806-4300-942c-aafe198aaa81" width="700">
</p>

BINGO
We can see a different cookie, so lets modify us cookie with this one
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/bd77d587-d86f-4561-aa30-ea68f7153d79"width="700">
</p>

Now we have access
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/f745bb79-8e5e-4c38-83ba-a27a0a538afc" width="700">
</p>

Testing the function of the dashboard a report is generated
This page no have a real functionality besides inform the state of the server
With the basics
#### Command Injection
Before do any try, open a nc listener ready to get a rev shell
``` Bash
ncat -lvnp 1234
```
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/bdf5ffe4-2d51-403f-a2af-580fe439b675" width="700">
</p>

Testing some commands to send a shell a nice one appear
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/b762b875-821b-4628-a6ec-4d4dda537e8f" width="700">
</p>

Now get the shell
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/f0b5cb33-e245-4d19-be8e-e3bde0d6809b" width="700">
</p>

#### User flag
In the home directory of the user is the user.txt flag
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/ae9f709e-b19f-45fa-bcd0-953d608ed603" width="700">
</p>

### Post-Explotation
#### Privilege Escalation
To do a Privilege escalation use
``` Bash
sudo -l
```
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/92a192cf-0df9-40fe-b0cd-9428ae1e7fad" width="700">
</p>

There are a binary no password needed to execute like super user
A few queries on google found an article talking about privilege escalation with syscheck mg src="https://medium.com/@adiamond186/usr-bin-syscheck-is-looking-for-the-initdb-sh-609cd006d913)

syschecks execute initdb.sh file if you modifies this file the content is executed like sudo user
Create the initdb.sh file wth "/bin/bash" in the content and add execution permissions
``` Bash
touch initdb.sh && echo "/bin/bash" > initdb.sh && chmod +x initdb.sh
```

Next, when executes the command:
``` Bash
sudo syscheck
```
Your initdb.sh file is executed
To test if your file is executed successful use ``id`` command
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/515a33d5-f49d-404c-94e3-b6d2dc67bbfa" width="700">
</p>

#### Root flag
On the root home directory is the root flag
<p align="center">
<img src="https://github.com/CesarGBkR/Pentesting-Notes/assets/99093357/f3c9e8d2-ef63-4dd7-a91b-3825dd572458" width="700">
</p>
  
# References
https://medium.com/@adiamond186/usr-bin-syscheck-is-looking-for-the-initdb-sh-609cd006d913
